<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenS – Operações</title>
  <style>
    body{font-family:system-ui;background:#0f172a;color:#e2e8f0;margin:0}
    .header{background:#1e293b;padding:20px;text-align:center;color:#60a5fa;font-size:1.8rem;font-weight:bold}
    .card{background:#1e293b;padding:30px;margin:20px auto;max-width:900px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.5)}
    input,textarea,select,button{width:100%;padding:14px;margin:10px 0;border-radius:8px;border:none;font-size:1rem}
    button{background:#60a5fa;color:#0f172a;cursor:pointer;font-weight:bold}
    button:hover{background:#93c5fd}
    .hidden{display:none}
    .tab button{margin:5px;padding:12px 24px;background:#334155;border:none;color:white;border-radius:8px;cursor:pointer}
    .tab button.active{background:#60a5fa;color:#0f172a}
    iframe{width:100%;height:80vh;border:none;border-radius:12px}
  </style>
</head>
<body>
  <div class="header">OpenS – Central de Operações</div>

  <div id="login" class="card">
    <h2 style="color:#60a5fa;text-align:center">Acesso Restrito</h2>
    <input type="email" id="email" placeholder="E-mail" value="admin@opens.com">
    <input type="password" id="senha" placeholder="Senha" value="opens2025">
    <button onclick="login()">Entrar no OpenS</button>
    <p id="msg" style="color:#fca5a5"></p>
  </div>

  <div id="app" class="hidden">
    <div class="tab">
      <button class="active" onclick="tab('ops')">Chamados</button>
      <button onclick="tab('bi')">Dashboard BI</button>
      <button onclick="localStorage.clear();location.reload()">Sair</button>
    </div>

    <div id="ops" class="card">
      <h3 style="color:#60a5fa">Novo Chamado</h3>
      <input id="titulo" placeholder="Título">
      <textarea id="desc" placeholder="Descreva o problema..."></textarea>
      <select id="prio"><option>MÉDIA</option><option>ALTA</option><option>BAIXA</option></select>
      <button onclick="criar()">Criar Chamado</button>
      <div id="lista" style="margin-top:20px"></div>
    </div>

    <div id="bi" class="card" style="display:none">
      <iframe src="https://app.powerbi.com/reportEmbed?reportId=COLE_SEU_ID_AQUI"></iframe>
    </div>
  </div>

  <script>
    let token = localStorage.getItem('opens_token') || '';
    if(token){ document.getElementById('login').classList.add('hidden'); document.getElementById('app').classList.remove('hidden'); load(); }

    async function login(){
      const res = await fetch('/api/login', {method:'POST', headers:{'Content-Type':'application/json'},
        body:JSON.stringify({email:email.value, senha:senha.value})});
      const d = await res.json();
      if(res.ok){ token=d.token; localStorage.setItem('opens_token',token); location.reload(); }
      else document.getElementById('msg').textContent = d.erro || 'Erro';
    }
    function tab(id){ document.querySelectorAll('#ops,#bi').forEach(e=>e.style.display='none'); document.getElementById(id).style.display='block'; }
    async function criar(){
      await fetch('/api/chamados', {method:'POST', headers:{'Content-Type':'application/json', Authorization:Bearer },
        body:JSON.stringify({titulo:titulo.value, descricao:desc.value, prioridade:prio.value})});
      titulo.value=desc.value=''; load();
    }
    async function load(){
      const res = await fetch('/api/chamados', {headers:{Authorization:Bearer }});
      const data = await res.json();
      document.getElementById('lista').innerHTML = data.map(c=>
        <div style="background:#334155;padding:15px;margin:10px 0;border-radius:8px;border-left:5px solid ">
          <strong>#\ \</strong> — \ — \<br>
          <small>\</small><br>
          <small style="color:#94a3b8">por \ • \</small>
        </div>).join('');
    }
  </script>
</body>
</html>
